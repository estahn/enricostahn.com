<!doctype html><html lang=en-us><head><title>PostgreSQL - Add Primary Key to an Existing Table | Enrico Stahn</title><meta charset=utf-8><meta name=language content="en"><meta name=description content><meta name=keywords content><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=twitter:card content="summary"><meta name=twitter:title content="PostgreSQL - Add Primary Key to an Existing Table"><meta name=twitter:description content><meta name=twitter:site content="https://twitter.com/estahn"><meta name=twitter:creator content="https://twitter.com/estahn"><link rel="shortcut icon" type=image/png href=/favicon.ico><link type=text/css rel=stylesheet href=/css/post.min.b60e0932fe1c50c3d7c5b4f83ee9e4592363654d0f2abf05bbd0678d5b8a214c.css integrity="sha256-tg4JMv4cUMPXxbT4PunkWSNjZU0PKr8Fu9BnjVuKIUw="><link type=text/css rel=stylesheet href=/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css integrity="sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU="><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/enricostahn.com\/post\/2011-06-11-postgresql-add-primary-key-to-an-existing-table\/","name":"PostgreSQL - Add Primary Key to an Existing Table","author":{"@type":"Person","name":""},"description":""}</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-416081-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><div class=burger__container><div class=burger aria-controls=navigation aria-label=Menu><div class="burger__meat burger__meat--1"></div><div class="burger__meat burger__meat--2"></div><div class="burger__meat burger__meat--3"></div></div></div><nav class=nav id=navigation><ul class=nav__list><li><a href=/>Home</a></li><li><a href=/post>Posts</a></li></ul></nav><main><div class=flex-wrapper><div class=post__container><div class=post><header class=post__header><h1 id=post__title>PostgreSQL - Add Primary Key to an Existing Table</h1><time datetime="2011-06-11 00:00:00 +0000 UTC" class=post__date>Jun 11 2011</time></header><article class=post__content><p>The database we’re working on has some strange design issues and some of them are incompatible with the ORM layer we’re moving to. One of the issues is the lack of a primary key in some tables. In PostgreSQL we can solve this with the following steps:</p><ol><li>Add a column with type integer to your table</li><li>Create a sequence</li><li>Update the column table with sequence values</li><li>Set the necessary column properties (e.g. default, not null, etc.)</li></ol><p>Example for table <code>foo</code> and column <code>id</code>:</p><div class=highlight><pre class=chroma><code class=language-sql data-lang=sql><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=s2>&#34;public&#34;</span><span class=p>.</span><span class=s2>&#34;foo&#34;</span> <span class=k>ADD</span> <span class=k>COLUMN</span> <span class=s2>&#34;id&#34;</span> <span class=nb>INTEGER</span><span class=p>;</span>
<span class=k>CREATE</span> <span class=n>SEQUENCE</span> <span class=s2>&#34;public&#34;</span><span class=p>.</span><span class=s2>&#34;foo_id_seq&#34;</span><span class=p>;</span>
<span class=k>UPDATE</span> <span class=n>foo</span> <span class=k>SET</span> <span class=n>id</span> <span class=o>=</span> <span class=n>nextval</span><span class=p>(</span><span class=s1>&#39;&#34;public&#34;.&#34;foo_id_seq&#34;&#39;</span><span class=p>);</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=s2>&#34;public&#34;</span><span class=p>.</span><span class=s2>&#34;foo&#34;</span> <span class=k>ALTER</span> <span class=k>COLUMN</span> <span class=s2>&#34;id&#34;</span> <span class=k>SET</span> <span class=k>DEFAULT</span> <span class=n>nextval</span><span class=p>(</span><span class=s1>&#39;&#34;public&#34;.&#34;foo_id_seq&#34;&#39;</span><span class=p>);</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=s2>&#34;public&#34;</span><span class=p>.</span><span class=s2>&#34;foo&#34;</span> <span class=k>ALTER</span> <span class=k>COLUMN</span> <span class=s2>&#34;id&#34;</span> <span class=k>SET</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>;</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=s2>&#34;public&#34;</span><span class=p>.</span><span class=s2>&#34;foo&#34;</span> <span class=k>ADD</span> <span class=k>UNIQUE</span> <span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>);</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=s2>&#34;public&#34;</span><span class=p>.</span><span class=s2>&#34;foo&#34;</span> <span class=k>DROP</span> <span class=k>CONSTRAINT</span> <span class=s2>&#34;foo_id_key&#34;</span> <span class=k>RESTRICT</span><span class=p>;</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=s2>&#34;public&#34;</span><span class=p>.</span><span class=s2>&#34;foo&#34;</span> <span class=k>ADD</span> <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>);</span>
</code></pre></div></article><div class=pagination><a class=pagination__item href=https://enricostahn.com/post/2015-03-17-reduce-local-test-kitchen-runtimes/><span class=pagination__label>Next Post</span>
<span class=pagination__title>Reduce local test kitchen runtimes</span></a></div><footer class=post__footer><div class=social-icons><a class=social-icons__link rel=me title=Twitter href=https://twitter.com/estahn target=_blank rel=noopener><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/twitter.svg)></div></a><a class=social-icons__link rel=me title=GitHub href=https://github.com/estahn target=_blank rel=noopener><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/github.svg)></div></a><a class=social-icons__link rel=me title=Email href=mailto:enrico.stahn@gmail.com target=_blank rel=noopener><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/email.svg)></div></a><a class=social-icons__link rel=me title=LinkedIn href=https://www.linkedin.com/in/enricostahn/ target=_blank rel=noopener><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/linkedin.svg)></div></a></div><p>Enrico Stahn © 2011 - 2021</p></footer></div></div></div></main><script src=/js/index.min.49e4d8a384357d9b445b87371863419937ede9fa77737522ffb633073aebfa44.js integrity="sha256-SeTYo4Q1fZtEW4c3GGNBmTft6fp3c3Ui/7YzBzrr+kQ=" crossorigin=anonymous></script><script src=https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js></script><script src=https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js data-autoloader-path=https://unpkg.com/prismjs@1.20.0/components/></script></body></html>