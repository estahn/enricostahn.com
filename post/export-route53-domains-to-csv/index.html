<!doctype html><html lang=en-us><head><title>Export AWS Route53 Domains as CSV for Excel people | Enrico Stahn</title><meta charset=utf-8><meta name=language content="en"><meta name=description content><meta name=keywords content><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=twitter:card content="summary"><meta name=twitter:title content="Export AWS Route53 Domains as CSV for Excel people"><meta name=twitter:description content><meta name=twitter:site content="https://twitter.com/estahn"><meta name=twitter:creator content="https://twitter.com/estahn"><link rel="shortcut icon" type=image/png href=/favicon.ico><link type=text/css rel=stylesheet href=/css/post.min.86d1effd4c412b85ac13db53a90c473a0f256f789b821e131125c9aa25cb6a6d.css integrity="sha256-htHv/UxBK4WsE9tTqQxHOg8lb3ibgh4TESXJqiXLam0="><link type=text/css rel=stylesheet href=/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css integrity="sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU="><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/enricostahn.com\/post\/export-route53-domains-to-csv\/","name":"Export AWS Route53 Domains as CSV for Excel people","author":{"@type":"Person","name":"Enrico Stahn"},"description":""}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-416081-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><div class=burger__container><div class=burger aria-controls=navigation aria-label=Menu><div class="burger__meat burger__meat--1"></div><div class="burger__meat burger__meat--2"></div><div class="burger__meat burger__meat--3"></div></div></div><nav class=nav id=navigation><ul class=nav__list><li><a href=/>Home</a></li><li><a href=/post>Posts</a></li></ul></nav><main><div class=flex-wrapper><div class=post__container><div class=post><header class=post__header><h1 id=post__title>Export AWS Route53 Domains as CSV for Excel people</h1><time datetime="2021-01-04 23:54:04 +1100 +1100" class=post__date>Jan 4 2021</time></header><article class=post__content><p>If you have a fairly large list of domains in your AWS account and want to create an easily consumable format for external departments (finance, legal, etc) then this script might be of help.</p><p>The script requires a valid AWS session with permissions to read domain details.</p><p>➡️ <a href=https://gist.github.com/estahn/33ee9f0ecede6416a168489a7a24ee24 target=_blank rel="noreferrer noopener">Available as Gist on GitHub</a></p><h2 id=installation>Installation<a class=anchor href=#installation>#</a></h2><p>Copy the following script into a file <code>domains.py</code> (<em>skip if you want to use <code>wget</code></em>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Export AWS Route53 Domains to a CSV for Excel people</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Usage:</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#   python3 &lt;(wget -q -O - https://gist.github.com/estahn/33ee9f0ecede6416a168489a7a24ee24/raw/5eef9122e573ff23bcd40732856565c37c708efd/domains.py)</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itertools</span> <span class=kn>import</span> <span class=n>chain</span><span class=p>,</span> <span class=n>starmap</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pandas.io.json</span> <span class=kn>import</span> <span class=n>json_normalize</span> <span class=c1>#package for flattening json in pandas df</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>listofdomains</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;route53domains&#39;</span><span class=p>,</span> <span class=n>region_name</span><span class=o>=</span><span class=s1>&#39;us-east-1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get_paginator</span><span class=p>(</span><span class=s1>&#39;list_domains&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>page</span> <span class=ow>in</span> <span class=n>p</span><span class=o>.</span><span class=n>paginate</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>domain</span> <span class=ow>in</span> <span class=n>page</span><span class=p>[</span><span class=s1>&#39;Domains&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>domain_detail</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get_domain_detail</span><span class=p>(</span><span class=n>DomainName</span><span class=o>=</span><span class=n>domain</span><span class=p>[</span><span class=s1>&#39;DomainName&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Remove response data, so it doesn&#39;t make it into the spreadsheet</span>
</span></span><span class=line><span class=cl>        <span class=k>del</span> <span class=n>domain_detail</span><span class=p>[</span><span class=s1>&#39;ResponseMetadata&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Re-map &#34;ExtraParams&#34; to flatten the JSON for the spreadsheet</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;RegistrantContact&#39;</span><span class=p>,</span> <span class=s1>&#39;TechContact&#39;</span><span class=p>,</span> <span class=s1>&#39;AdminContact&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>domain_detail</span><span class=p>[</span><span class=n>c</span><span class=p>][</span><span class=s1>&#39;ExtraParams&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>domain_detail</span><span class=p>[</span><span class=n>c</span><span class=p>][</span><span class=n>p</span><span class=p>[</span><span class=s1>&#39;Name&#39;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>p</span><span class=p>[</span><span class=s1>&#39;Value&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>del</span> <span class=n>domain_detail</span><span class=p>[</span><span class=n>c</span><span class=p>][</span><span class=s1>&#39;ExtraParams&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>listofdomains</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>domain_detail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>json_normalize</span><span class=p>(</span><span class=n>listofdomains</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=o>.</span><span class=n>to_csv</span> <span class=p>(</span><span class=sa>r</span><span class=s1>&#39;domains.csv&#39;</span><span class=p>,</span> <span class=n>index</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>header</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=usage>Usage<a class=anchor href=#usage>#</a></h2><p>Either run the script created during the installation step:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ python3 domains.py
</span></span></code></pre></div><p>or run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ python3 &lt;<span class=o>(</span>wget -q -O - https://gist.github.com/estahn/33ee9f0ecede6416a168489a7a24ee24/raw/5eef9122e573ff23bcd40732856565c37c708efd/domains.py<span class=o>)</span>
</span></span></code></pre></div><p>This will create a file <code>domains.csv</code> containing the required information.</p></article><ul class=tags__list><li class=tag__item><a class=tag__link href=https://enricostahn.com/tags/python/>python</a></li><li class=tag__item><a class=tag__link href=https://enricostahn.com/tags/aws/>aws</a></li><li class=tag__item><a class=tag__link href=https://enricostahn.com/tags/route53/>route53</a></li><li class=tag__item><a class=tag__link href=https://enricostahn.com/tags/csv/>csv</a></li><li class=tag__item><a class=tag__link href=https://enricostahn.com/tags/excel/>excel</a></li></ul><div class=pagination><a class=pagination__item href=https://enricostahn.com/post/kubernetes-secrets-in-plaintext/><span class=pagination__label>Previous Post</span>
<span class=pagination__title>Kubernetes Secrets in plain-text</span></a></div><footer class=post__footer><div class=social-icons><a class=social-icons__link title=Twitter href=https://twitter.com/estahn target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/twitter.svg)></div></a><a class=social-icons__link title=GitHub href=https://github.com/estahn target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/github.svg)></div></a><a class=social-icons__link title=Email href=mailto:enrico.stahn@gmail.com target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/email.svg)></div></a><a class=social-icons__link title=LinkedIn href=https://www.linkedin.com/in/enricostahn/ target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/linkedin.svg)></div></a></div><p>Enrico Stahn © 2011 - 2022</p></footer></div></div><div class=toc-container><nav id=TableOfContents><ul><li><a href=#installation>Installation</a></li><li><a href=#usage>Usage</a></li></ul></nav></div></div></main><script src=/js/index.min.301a8b0870381bf76b3b5182e8966d363a0474281183439beb024d8b8228fc66.js integrity="sha256-MBqLCHA4G/drO1GC6JZtNjoEdCgRg0Ob6wJNi4Io/GY=" crossorigin=anonymous></script>
<script src=https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js></script>
<script src=https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js data-autoloader-path=https://unpkg.com/prismjs@1.20.0/components/></script>
<script src=/js/table-of-contents.js></script></body></html>