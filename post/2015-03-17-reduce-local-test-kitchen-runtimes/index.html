<!doctype html><html lang=en-us><head><title>Reduce local test kitchen runtimes | Enrico Stahn</title><meta charset=utf-8><meta name=language content="en"><meta name=description content><meta name=keywords content><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=twitter:card content="summary"><meta name=twitter:title content="Reduce local test kitchen runtimes"><meta name=twitter:description content><meta name=twitter:site content="https://twitter.com/estahn"><meta name=twitter:creator content="https://twitter.com/estahn"><link rel="shortcut icon" type=image/png href=/favicon.ico><link type=text/css rel=stylesheet href=/css/post.min.86d1effd4c412b85ac13db53a90c473a0f256f789b821e131125c9aa25cb6a6d.css integrity="sha256-htHv/UxBK4WsE9tTqQxHOg8lb3ibgh4TESXJqiXLam0="><link type=text/css rel=stylesheet href=/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css integrity="sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU="><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/enricostahn.com\/post\/2015-03-17-reduce-local-test-kitchen-runtimes\/","name":"Reduce local test kitchen runtimes","author":{"@type":"Person","name":""},"description":""}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-416081-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><div class=burger__container><div class=burger aria-controls=navigation aria-label=Menu><div class="burger__meat burger__meat--1"></div><div class="burger__meat burger__meat--2"></div><div class="burger__meat burger__meat--3"></div></div></div><nav class=nav id=navigation><ul class=nav__list><li><a href=/>Home</a></li><li><a href=/post>Posts</a></li></ul></nav><main><div class=flex-wrapper><div class=post__container><div class=post><header class=post__header><h1 id=post__title>Reduce local test kitchen runtimes</h1><time datetime="2015-03-17 09:00:00 +0000 UTC" class=post__date>Mar 17 2015</time></header><article class=post__content><p>At <a href=http://www.zanui.com.au/ target=_blank rel="noreferrer noopener">Zanui</a> we&rsquo;ve been working with Vagrant, Puppet and Chef for quite a while. We&rsquo;re happy with these tools, at least most of the time.</p><p>A major discomfort is the time taken to download any kind of assets during provisioning, e.g.</p><ul><li>Omnibus: Chef Install</li><li>Apt update / packages</li><li>Pip packages</li><li>&mldr;</li></ul><p>While this is annoying it&rsquo;s usually not an issue for non-repetitive runs. These usually occur with a new team member or when a development box needs to be rebuild due to errors.</p><p>The opposite is the case for <a href=https://github.com/test-kitchen/test-kitchen target=_blank rel="noreferrer noopener">test kitchen</a> runs. Testing your cookbook multiple times on multiple systems is crucial but a burden when it slows you down.</p><blockquote></blockquote><p><a href=https://github.com/fgrehm/vagrant-cachier target=_blank rel="noreferrer noopener">vagrant-cachier</a> is the first idea that comes to mind to improve runtimes. Unfortunately kitchen <a href=https://github.com/test-kitchen/kitchen-vagrant/pull/37 target=_blank rel="noreferrer noopener">doesn&rsquo;t support</a> vagrant-cachier directly. Instead you need to create a Vagrantfile ERB template and eventually maintain it in your repository. Not pretty.</p><p>Another idea is to use an HTTP Proxy as an intermediate to store any kind of downloads over multiple kitchen runs. <a href=https://gist.github.com/fnichol target=_blank rel="noreferrer noopener">Fletcher Nichol</a> created a nice little snippet that you just chuck into <code>$HOME/.kitchen/config.yml</code> then install a proxy such as <a href=http://www.pps.univ-paris-diderot.fr/~jch/software/polipo/ target=_blank rel="noreferrer noopener">polipo</a> and you&rsquo;re good to go.</p><p>I had mediocre success with polipo, even after building it from master. A more stable solution is <a href=http://squidman.net/squidman/ target=_blank rel="noreferrer noopener">SquidMan</a>. It&rsquo;s a fancy interface on top Squid.
<img src=/img/squidman-preferences-general.png alt="SquidMan - Preferences - General">
You want to bump up the <em>Cache size</em> and <em>Maximum object size</em> to maximum. And allow access to either your IP or an entire network range.
<img src=/img/squidman-preferences-clients.png alt="SquidMan - Preferences - Clients"></p></article><ul class=tags__list><li class=tag__item><a class=tag__link href=https://enricostahn.com/tags/chef/>chef</a></li><li class=tag__item><a class=tag__link href=https://enricostahn.com/tags/kitchen/>kitchen</a></li><li class=tag__item><a class=tag__link href=https://enricostahn.com/tags/devops/>devops</a></li></ul><div class=pagination><a class=pagination__item href=https://enricostahn.com/post/2011-06-11-postgresql-add-primary-key-to-an-existing-table/><span class=pagination__label>Previous Post</span>
<span class=pagination__title>PostgreSQL - Add Primary Key to an Existing Table</span></a>
<a class=pagination__item href=https://enricostahn.com/post/2016-03-05-jq-for-php/><span class=pagination__label>Next Post</span>
<span class=pagination__title>jq for PHP</span></a></div><footer class=post__footer><div class=social-icons><a class=social-icons__link title=Twitter href=https://twitter.com/estahn target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/twitter.svg)></div></a><a class=social-icons__link title=GitHub href=https://github.com/estahn target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/github.svg)></div></a><a class=social-icons__link title=Email href=mailto:enrico.stahn@gmail.com target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/email.svg)></div></a><a class=social-icons__link title=LinkedIn href=https://www.linkedin.com/in/enricostahn/ target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://enricostahn.com/svg/linkedin.svg)></div></a></div><p>Enrico Stahn Â© 2011 - 2022</p></footer></div></div></div></main><script src=/js/index.min.301a8b0870381bf76b3b5182e8966d363a0474281183439beb024d8b8228fc66.js integrity="sha256-MBqLCHA4G/drO1GC6JZtNjoEdCgRg0Ob6wJNi4Io/GY=" crossorigin=anonymous></script>
<script src=https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js></script>
<script src=https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js data-autoloader-path=https://unpkg.com/prismjs@1.20.0/components/></script></body></html>